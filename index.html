<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>WebSendADB Demo Build 4</title>
  <link href="https://cdn.jsdelivr.net/gh/creativetimofficial/soft-ui-dashboard/assets/css/soft-ui-dashboard.css" rel="stylesheet"/>
  <style>
    body { background: #f8f9fa; color: #333; }
    .card { margin-top: 2rem; }
    #historyList { max-height: 150px; overflow-y:auto; padding:.5rem; background:#eef2f7; }
    #historyList div { padding:.2rem; cursor:pointer; }
    #historyList div:hover { background:#dce4eb; }
  </style>
</head>
<body>
  <nav class="navbar navbar-light bg-white shadow-sm">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">WebSendADB Demo Build 4</a>
    </div>
  </nav>

  <div class="container py-4">
    <div class="card shadow-sm p-4">
      <h5>Select USB Filter Preset</h5>
      <select id="presetSelect" class="form-select mb-3">
        <option value="default" selected>Default (Google, Samsung, Xiaomi)</option>
        <option value="google">Google Only</option>
        <option value="samsung">Samsung Only</option>
        <option value="xiaomi">Xiaomi Only</option>
        <option value="custom">Custom filter...</option>
      </select>
      <button id="customFilterBtn" class="btn btn-outline-primary mb-3" style="display:none;">
        Add Custom Filter
      </button>

      <button id="connectBtn" class="btn btn-success">Connect to ADB</button>
      <span id="status" class="ms-3">Status: <em>Disconnected</em></span>

      <div class="mt-3 mb-3">
        <input id="commandInput" type="text" class="form-control d-inline-block" style="width:70%" placeholder="e.g. pm list packages"/>
        <button id="sendBtn" class="btn btn-primary">Send</button>
      </div>

      <div class="mb-3">
        <h6>History (click to reuse):</h6>
        <div id="historyList"></div>
      </div>

      <h6>Output:</h6>
      <pre id="output" class="bg-light p-3" style="height:200px;overflow:auto;"></pre>
    </div>

    <div class="card mt-4 p-3">
      <h5>üîç Under the Hood (Build 4 Demo)</h5>
      <ul>
        <li>Uses <strong>wsadb.js build‚ÄØ10</strong> with ESM & smart loader (CDN fallback).</li>
        <li>Still packed with presets, custom filters, history, and smart device info fetch.</li>
      </ul>
    </div>
  </div>

  <script type="module" src="path/to/wsadb.js"></script>
  <script>
    console.log('WebSendADB Demo Build 4 loaded');

    const presetSelect = document.getElementById('presetSelect');
    const customFilterBtn = document.getElementById('customFilterBtn');
    const connectBtn = document.getElementById('connectBtn');
    const sendBtn = document.getElementById('sendBtn');
    const statusEl = document.getElementById('status');
    const outputEl = document.getElementById('output');
    const cmdInput = document.getElementById('commandInput');
    const historyList = document.getElementById('historyList');

    function renderHistory() {
      historyList.innerHTML = '';
      WebSendADB.getHistory().forEach(cmd => {
        const d = document.createElement('div');
        d.textContent = cmd;
        d.onclick = () => (cmdInput.value = cmd);
        historyList.appendChild(d);
      });
    }

    presetSelect.onchange = () => {
      const v = presetSelect.value;
      WebSendADB.usePreset(v);
      statusEl.textContent = `Status: Preset: ${v}`;
      customFilterBtn.style.display = v === 'custom' ? 'inline-block' : 'none';
    };

    customFilterBtn.onclick = () => {
      const code = prompt('Enter filter JSON (e.g. {"vendorId":1234}):');
      try {
        const obj = JSON.parse(code);
        WebSendADB.addCustomFilter(obj);
        alert('Custom filter added');
      } catch {
        alert('Invalid JSON');
      }
    };

    connectBtn.onclick = async () => {
      try {
        statusEl.textContent = 'Status: Connecting...';
        await WebSendADB.connect();
        statusEl.textContent = 'Status: Connected!';
      } catch (e) {
        statusEl.textContent = 'Error: ' + e.message;
        console.error(e);
      }
    };

    sendBtn.onclick = async () => {
      const cmd = cmdInput.value.trim();
      if (!cmd) return;
      sendBtn.disabled = true;
      outputEl.textContent = '> ' + cmd + '\n\n';
      try {
        const res = await WebSendADB.sendCommand(cmd);
        outputEl.textContent += res;
        renderHistory();
      } catch (e) {
        outputEl.textContent += 'Error: ' + e.message;
      } finally {
        sendBtn.disabled = false;
      }
    };
  </script>
</body>
</html>
